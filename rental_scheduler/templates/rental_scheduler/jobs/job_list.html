{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_js %}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900">{{ title }}</h1>
        <div class="flex gap-3">
            <a href="{% url 'rental_scheduler:job_export' %}" 
               class="inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 11l3 3m0 0l3-3m-3 3V8"></path>
                </svg>
                Export Jobs
            </a>
            <a href="{% url 'rental_scheduler:import_history' %}" 
               class="inline-flex items-center gap-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Import History
            </a>
            <a href="{% url 'rental_scheduler:job_import_json' %}" 
               class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                Import Jobs
            </a>
            <a href="{% url 'rental_scheduler:calendar' %}" 
               class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md hover:shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                View Calendar
            </a>
        </div>
    </div>

    <!-- Search and Filter Form -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <form method="get" class="flex flex-wrap items-end gap-3">
            <div class="flex-1 min-w-0">
                <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                <input type="text" name="search" id="search" value="{{ current_filters.search }}"
                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Search jobs...">
            </div>
            <div class="flex-shrink-0 w-32">
                <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <select name="status" id="status" 
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">All Statuses</option>
                    {% for value, label in status_choices %}
                        <option value="{{ value }}" {% if current_filters.status == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex-shrink-0 w-32">
                <label for="calendar" class="block text-sm font-medium text-gray-700 mb-1">Calendar</label>
                <select name="calendar" id="calendar" 
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">All Calendars</option>
                    {% for calendar in calendars %}
                        <option value="{{ calendar.id }}" {% if current_filters.calendar == calendar.id|stringformat:"s" %}selected{% endif %}>
                            {{ calendar.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex-shrink-0">
                <label class="block text-sm font-medium text-gray-700 mb-1 invisible">Filter</label>
                <button type="submit" 
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition duration-200 text-sm whitespace-nowrap">
                    Filter
                </button>
            </div>
        </form>
    </div>

    <!-- Jobs Table Container -->
    <div id="job-table-container">
        {% include 'rental_scheduler/partials/job_list_table.html' with jobs=jobs current_sort=current_sort current_direction=current_direction current_filters=current_filters %}
    </div>
</div>

<script>
// Initialize job dialog instance

document.addEventListener('DOMContentLoaded', function() {
    // Make table rows clickable
    const jobRows = document.querySelectorAll('.job-row');
    
    jobRows.forEach(row => {
        row.addEventListener('click', function(e) {
            // Don't navigate if user clicked on an action link or button
            if (e.target.tagName === 'A' || e.target.closest('a') || e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                return;
            }
            
            // Get job data from the row
            const jobId = this.getAttribute('data-job-id');
            if (jobId) {
                // Create minimal job data - the dialog will fetch full details
                const jobData = {
                    job_id: jobId
                };
                
                // Open the comprehensive dialog
                if (!jobDialog) {
                    jobDialog = new JobDialog();
                }
                jobDialog.openJobDetailsDialog(jobData);
            }
        });
        
        // Add visual feedback on hover
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f9fafb';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });
});
</script>

{% endblock %}

