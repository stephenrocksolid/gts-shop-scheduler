{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="mx-auto max-w-4xl px-4 py-6">

  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">{{ title|default:"Create Job" }}</h1>
    <p class="mt-2 text-sm text-gray-600">Fill out the form below to create a new job or event.</p>
  </div>

  <!-- Main Form -->
  <div class="bg-white shadow-sm rounded-lg border border-gray-200">
    
    <form id="job-form" method="post" action="{% url 'rental_scheduler:job_create' %}">
      {% csrf_token %}

      <!-- Error Summary -->
      {% if form.errors %}
      <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
            <ul class="mt-2 list-disc list-inside text-sm text-red-700">
              {% for field, errs in form.errors.items %}
                {% for error in errs %}
                  <li>{{ field|capfirst }}: {{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}

      <div class="px-6 py-6 space-y-6">

        <!-- Calendar Selection -->
        <div>
          <label for="{{ form.calendar.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
            Calendar <span class="text-red-500">*</span>
          </label>
          {{ form.calendar }}
          {% if form.calendar.errors %}
            <p class="mt-1 text-sm text-red-600">
              {% for error in form.calendar.errors %}{{ error }}{% endfor %}
            </p>
          {% endif %}
          {% if form.calendar.help_text %}
            <p class="mt-1 text-sm text-gray-500">{{ form.calendar.help_text }}</p>
          {% endif %}
        </div>

        <!-- Date & Time Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Start Date & Time -->
          <div>
            <label for="{{ form.start_dt.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Start Date & Time <span class="text-red-500">*</span>
            </label>
            {{ form.start_dt }}
            {% if form.start_dt.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.start_dt.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- End Date & Time -->
          <div>
            <label for="{{ form.end_dt.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              End Date & Time <span class="text-red-500">*</span>
            </label>
            {{ form.end_dt }}
            {% if form.end_dt.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.end_dt.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>
        </div>

        <!-- All Day & Date Call Received Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- All Day Toggle -->
          <div>
            <div class="flex items-center">
              {{ form.all_day }}
              <label for="{{ form.all_day.id_for_label }}" class="ml-2 text-sm font-medium text-gray-900">
                All Day Event
              </label>
            </div>
            {% if form.all_day.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.all_day.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- Date Call Received -->
          <div>
            <label for="{{ form.date_call_received.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Date Call Received
            </label>
            {{ form.date_call_received }}
            {% if form.date_call_received.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.date_call_received.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>
        </div>

        <!-- Customer Information Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Business Name -->
          <div>
            <label for="{{ form.business_name.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Business Name
            </label>
            {{ form.business_name }}
            {% if form.business_name.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.business_name.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- Contact Name -->
          <div>
            <label for="{{ form.contact_name.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Contact Name
            </label>
            {{ form.contact_name }}
            {% if form.contact_name.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.contact_name.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>
        </div>

        <!-- Phone & Repeat -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Phone -->
          <div>
            <label for="{{ form.phone.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Phone
            </label>
            {{ form.phone }}
            {% if form.phone.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.phone.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- Repeat Type -->
          <div>
            <label for="{{ form.repeat_type.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Repeat
            </label>
            {{ form.repeat_type }}
            {% if form.repeat_type.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.repeat_type.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>
        </div>

        <!-- Trailer Information Row -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Trailer Color -->
          <div>
            <label for="{{ form.trailer_color.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Trailer Color
            </label>
            {{ form.trailer_color }}
            {% if form.trailer_color.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.trailer_color.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- Trailer Serial -->
          <div>
            <label for="{{ form.trailer_serial.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Serial #
            </label>
            {{ form.trailer_serial }}
            {% if form.trailer_serial.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.trailer_serial.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>

          <!-- Trailer Details -->
          <div>
            <label for="{{ form.trailer_details.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
              Details
            </label>
            {{ form.trailer_details }}
            {% if form.trailer_details.errors %}
              <p class="mt-1 text-sm text-red-600">
                {% for error in form.trailer_details.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}
          </div>
        </div>

        <!-- Notes Section -->
        <div>
          <label for="{{ form.notes.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
            Notes
          </label>
          {{ form.notes }}
          {% if form.notes.errors %}
            <p class="mt-1 text-sm text-red-600">
              {% for error in form.notes.errors %}{{ error }}{% endfor %}
            </p>
          {% endif %}
        </div>

        <!-- Repair Notes Section -->
        <div>
          <label for="{{ form.repair_notes.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
            Repair Notes
          </label>
          {{ form.repair_notes }}
          {% if form.repair_notes.errors %}
            <p class="mt-1 text-sm text-red-600">
              {% for error in form.repair_notes.errors %}{{ error }}{% endfor %}
            </p>
          {% endif %}
        </div>

        <!-- Quote Section -->
        <div>
          <label for="{{ form.quote.id_for_label }}" class="block text-sm font-medium text-gray-900 mb-2">
            Quote ($)
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <span class="text-gray-500 text-sm">$</span>
            </div>
            {{ form.quote }}
          </div>
          {% if form.quote.errors %}
            <p class="mt-1 text-sm text-red-600">
              {% for error in form.quote.errors %}{{ error }}{% endfor %}
            </p>
          {% endif %}
        </div>

      </div>

      <!-- Hidden Fields -->
      <div style="display: none;">
        {{ form.status }}
        {% for hidden in form.hidden_fields %}
          {{ hidden }}
        {% endfor %}
      </div>

      <!-- Form Actions -->
      <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex items-center justify-between">
        <a href="{% url 'rental_scheduler:job_list' %}" 
           class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
          Cancel
        </a>
        <button type="submit"
                class="inline-flex items-center px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
          Save
        </button>
      </div>

    </form>
  </div>
</div>

<script>
// Simple form validation
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('job-form');
    
    form.addEventListener('submit', function(e) {
        // Basic client-side validation
        const startDt = form.querySelector('#id_start_dt');
        const endDt = form.querySelector('#id_end_dt');
        
        if (startDt && endDt && startDt.value && endDt.value) {
            const startDate = new Date(startDt.value);
            const endDate = new Date(endDt.value);
            
            if (endDate < startDate) {
                e.preventDefault();
                alert('End date must be after start date.');
                return false;
            }
        }
    });
});
</script>
{% endblock %}