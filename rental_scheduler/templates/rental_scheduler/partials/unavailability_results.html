{% load static %}

{% if unavailable_trailers %}
<div class="space-y-2">
    {% for trailer in unavailable_trailers %}
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="p-4">
            <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-1">
                        <h4 class="text-base font-semibold text-gray-900">Trailer {{ trailer.number }}</h4>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium {% if trailer.reason == 'booked' and trailer.has_overdue %}bg-orange-100 text-orange-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {% if trailer.reason == 'booked' and trailer.has_overdue %}
                            Overdue
                            {% elif trailer.reason == 'booked' %}
                            Booked
                            {% elif trailer.reason == 'under_service' %}
                            In Service
                            {% elif trailer.reason == 'not_active' %}
                            Not Active
                            {% else %}
                            Unavailable
                            {% endif %}
                        </span>
                    </div>
                    <div class="text-sm text-gray-600">
                        <span><strong>Model:</strong> {{ trailer.model }}</span>
                        {% if trailer.size %}
                        <span class="ml-4"><strong>Size:</strong> {{ trailer.size }}</span>
                        {% endif %}
                        {% if trailer.hauling_capacity %}
                        <span class="ml-4"><strong>Capacity:</strong> {{ trailer.hauling_capacity|floatformat:0 }} lbs</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Unavailability Details -->
            <div class="mt-4 pt-4 border-t border-gray-100">
                {% if trailer.reason == 'booked' %}
                <h5 class="text-sm font-medium text-gray-900 mb-2">Booked During This Period:</h5>
                <div class="space-y-2">
                    {% for detail in trailer.details %}
                    <div class="bg-red-50 rounded-md p-3">
                        <div class="flex justify-between items-start">
                            <div class="text-sm">
                                <div class="font-medium text-red-800">{{ detail.customer }}</div>
                                {% if detail.status == 'returned_early' %}
                                <div class="text-red-600 mt-1">
                                    {{ detail.start }} → {{ detail.scheduled_end }}
                                </div>
                                {% if detail.end %}
                                <div class="text-red-700 mt-1">
                                    Returned early; actual return {{ detail.end }}.
                                </div>
                                {% endif %}
                                {% elif detail.status == 'returned_late' %}
                                <div class="text-red-600 mt-1">
                                    {{ detail.start }} → {{ detail.scheduled_end }}
                                </div>
                                {% if detail.end %}
                                <div class="text-red-700 mt-1">
                                    Returned late on {{ detail.end }}; therefore unavailable for your selected period.
                                </div>
                                {% endif %}
                                {% else %}
                                <div class="text-red-600 mt-1">
                                    {{ detail.start }} → {{ detail.scheduled_end }}
                                </div>
                                {% if detail.is_past_due %}
                                <div class="text-red-700 mt-1">
                                    Not returned yet; blocking continues past scheduled end.
                                </div>
                                {% endif %}
                                {% endif %}
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Contract</span>
                                <button type="button" class="px-2 py-1 text-xs rounded border border-gray-300 bg-white hover:bg-gray-50 text-gray-700" data-contract-id="{{ detail.id }}" data-is-picked-up="{{ detail.is_picked_up|yesno:'true,false' }}" data-is-returned="{{ detail.is_returned|yesno:'true,false' }}" data-is-invoiced="{{ detail.is_invoiced|yesno:'true,false' }}" data-return-iso="{{ detail.return_iso|default:'' }}">
                                    Update Status
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% elif trailer.reason == 'under_service' %}
                <h5 class="text-sm font-medium text-gray-900 mb-2">Service Scheduled:</h5>
                <div class="space-y-2">
                    {% for detail in trailer.details %}
                    <div class="bg-yellow-50 rounded-md p-3">
                        <div class="flex justify-between items-start">
                            <div class="text-sm">
                                <div class="font-medium text-yellow-800">{{ detail.description }}</div>
                                <div class="text-yellow-600 mt-1">
                                    {{ detail.start }} → {{ detail.end }}
                                </div>
                            </div>
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                Service
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% elif trailer.reason == 'not_active' %}
                <div class="bg-gray-50 rounded-md p-3">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-gray-400 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-sm text-gray-600">Trailer is marked as not available for rental</span>
                    </div>
                </div>
                {% else %}
                <div class="bg-gray-50 rounded-md p-3">
                    <div class="flex items-center">
                        <svg class="h-5 w-5 text-gray-400 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-sm text-gray-600">Trailer is unavailable for an unknown reason</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-12">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <h3 class="mt-4 text-lg font-medium text-gray-900">All Trailers Available</h3>
    <p class="mt-2 text-sm text-gray-500">
        Great! All trailers in this category are available for the selected time period.
    </p>
</div>
{% endif %}