{% load static %}

{# Chunk template for HTMX load-more: appends rows to #job-table-body and updates pagination controls via OOB #}

{# Wrap in tbody so HTMX can parse the response; we'll use hx-select to extract only the rows #}
<tbody id="job-list-chunk-wrapper">
{# Optional section header if crossing boundary from upcoming to past #}
{% if date_filter == 'all' and current_sort == 'smart' and prev_is_past_event == 0 and first_row_is_past %}
    <tr class="bg-gray-100 border-t-2 border-gray-300">
        <td colspan="7" class="px-6 py-2 text-sm font-semibold text-gray-600 uppercase tracking-wide">
            Past Events
        </td>
    </tr>
{% endif %}

{# Job rows to append #}
{% for job in jobs %}
    {# Only insert section header if this is the first row and we're crossing boundary #}
    {% if date_filter == 'all' and current_sort == 'smart' %}
        {% if forloop.first and prev_is_past_event == 0 and job.is_past_event %}
            {# Header already emitted above, skip #}
        {% elif not forloop.first %}
            {# Check if we're crossing boundary mid-chunk #}
            {% ifchanged job.is_past_event %}
                {% if job.is_past_event %}
                    <tr class="bg-gray-100 border-t-2 border-gray-300">
                        <td colspan="7" class="px-6 py-2 text-sm font-semibold text-gray-600 uppercase tracking-wide">
                            Past Events
                        </td>
                    </tr>
                {% endif %}
            {% endifchanged %}
        {% endif %}
    {% endif %}
    {% include 'rental_scheduler/partials/job_row.html' with job=job %}
{% endfor %}
</tbody>

{# Out-of-band update for entire pagination footer - processed BEFORE hx-select filtering #}
{% include 'rental_scheduler/partials/job_list_pagination_footer.html' with oob=True %}

