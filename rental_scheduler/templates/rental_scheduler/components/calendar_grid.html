{% load static %}

<div class="calendar-grid-container">
    <!-- Calendar Header -->
    <div class="calendar-grid-header">
        <!-- Left Group: Navigation and Today -->
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
                <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors duration-200" onclick="previousMonth()">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
                
                <h2 class="text-lg font-semibold text-gray-900 min-w-[140px] text-center">{{ current_month_year }}</h2>
                
                <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors duration-200" onclick="nextMonth()">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            
            <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition-colors duration-200" onclick="goToToday()">
                Today
            </button>
        </div>
        
        <!-- Right Group: View Toggle -->
        <div class="flex items-center">
            <div class="flex bg-gray-200 rounded-lg p-1 gap-1">
                <button class="view-btn px-3 py-1 text-sm font-medium rounded-md transition-colors duration-200 bg-blue-600 text-white" data-view="dayGridMonth">
                    Month
                </button>
                <button class="view-btn px-3 py-1 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-gray-300" data-view="timeGridWeek">
                    Week
                </button>
                <button class="view-btn px-3 py-1 text-sm font-medium rounded-md transition-colors duration-200 text-gray-700 hover:bg-gray-300" data-view="timeGridDay">
                    Day
                </button>
            </div>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
        <!-- Day Headers -->
        <div class="calendar-day-headers">
            {% for day in day_headers %}
            <div class="day-header">{{ day }}</div>
            {% endfor %}
        </div>

        <!-- Calendar Days -->
        <div class="calendar-days" id="calendar-days">
            {% for week in calendar_weeks %}
            <div class="calendar-week">
                {% for day in week %}
                <div class="calendar-day {% if day.is_today %}today{% endif %} {% if day.is_other_month %}other-month{% endif %}"
                     data-date="{{ day.date|date:'Y-m-d' }}">
                    
                    <!-- Day Number -->
                    <div class="day-number">{{ day.day_number }}</div>
                    
                    <!-- Day Events -->
                    <div class="day-events">
                        {% for event in day.events %}
                        {% include "rental_scheduler/components/job_chip.html" with job=event %}
                        {% endfor %}
                    </div>
                    
                    <!-- Add Event Button -->
                    <button class="add-event-btn" onclick="addEvent('{{ day.date|date:'Y-m-d' }}')" title="Add job">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.calendar-grid-container {
    @apply bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden;
}

.calendar-grid-header {
    @apply flex justify-between items-center p-4 border-b border-gray-200 bg-white;
}

.calendar-grid {
    @apply divide-y divide-gray-200;
}

.calendar-day-headers {
    @apply grid grid-cols-7 bg-gray-50;
}

.day-header {
    @apply p-3 text-sm font-medium text-gray-700 text-center;
}

.calendar-days {
    @apply divide-y divide-gray-200;
}

.calendar-week {
    @apply grid grid-cols-7 divide-x divide-gray-200;
}

.calendar-day {
    @apply min-h-[120px] p-2 relative hover:bg-gray-50 transition-colors duration-200;
}

.calendar-day.today {
    @apply bg-red-50;
}

.calendar-day.other-month {
    @apply bg-gray-50;
}

.day-number {
    @apply text-sm font-medium text-gray-900 mb-1;
}

.calendar-day.today .day-number {
    @apply text-red-600;
}

.calendar-day.other-month .day-number {
    @apply text-gray-400;
}

.day-events {
    @apply space-y-1;
}

.add-event-btn {
    @apply absolute bottom-1 right-1 p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors duration-200 opacity-0 group-hover:opacity-100;
}

.calendar-day:hover .add-event-btn {
    @apply opacity-100;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .calendar-grid-header {
        @apply flex-col gap-3;
    }
    
    .calendar-nav {
        @apply w-full justify-between;
    }
    
    .calendar-actions {
        @apply w-full justify-center;
    }
    
    .calendar-day {
        @apply min-h-[80px] p-1;
    }
    
    .day-number {
        @apply text-xs;
    }
}

@media (max-width: 640px) {
    .calendar-day {
        @apply min-h-[60px];
    }
    
    .day-events {
        @apply space-y-0.5;
    }
}
</style>

<script>
function previousMonth() {
    if (window.calendar) {
        window.calendar.prev();
    }
}

function nextMonth() {
    if (window.calendar) {
        window.calendar.next();
    }
}

function goToToday() {
    if (window.calendar) {
        window.calendar.today();
    }
}

function addEvent(date) {
    window.location.href = `{% url 'rental_scheduler:job_create' %}?date=${date}&next={% url 'rental_scheduler:calendar' %}`;
}

// View selector functionality
document.addEventListener('DOMContentLoaded', function() {
    const viewBtns = document.querySelectorAll('.view-btn');
    viewBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const view = this.dataset.view;
            
            // Update active state
            viewBtns.forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white');
                b.classList.add('text-gray-700', 'hover:bg-gray-300');
            });
            this.classList.remove('text-gray-700', 'hover:bg-gray-300');
            this.classList.add('bg-blue-600', 'text-white');
            
            // Change calendar view
            if (window.calendar) {
                window.calendar.changeView(view);
            }
        });
    });
});
</script>


